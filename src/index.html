<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <title>KEES Chat Bot</title>
</head>

<body>

    <div id="badgeID" class="notification">
        <span class="badge" id="badge">1</span>
    </div>
  <div class="main-container" id="main-container" role="application">
    <div><df-messenger
      intent="WELCOME"
      chat-title="NYDOL FAQ"
      agent-id="f4a7f408-4a71-4bb1-a156-85513ce43d96"
      language-code="en"
     ></df-messenger></div>
      
  <script>
    var counter = 0;
    var x = document.getElementById("chat_on");
    var y = document.getElementById("chat_off");
    var z = document.getElementById('chat-frame').src;
    var url = 'https://uidev.srv15-va.com/agent/?query=COVID';
    document.getElementById('badgeID').style.display = 'none';

    window.addEventListener("message", (event) => {
        const state = document.getElementById("chat-window").style.display;

        if (event.data === "newMessage" && state === 'none') {
            document.getElementById('badgeID').style.display = 'flex';
            counter++;
            document.getElementById('badge').innerText = counter;
        }
    })

    // To handle keyboard operations and mouse click starts here
    document.getElementById('chat_off').addEventListener('mousedown', function () {
        toggleForm();
        if ((z === '') || (z === null)) {
            document.getElementById('chat-frame').src = url;
            z = document.getElementById('chat-frame').src
        }

    });

    // keydown event on heading area to open the chatBot
    document.getElementById('chat_off').addEventListener('keydown', function () {
        // To handle keyboard operations for 38 (keyUp) 40 (keydown) 32 (Space) 13 (enter)
        if ((event.keyCode === 38) || (event.keyCode === 40) || (event.keyCode === 32) || (event.keyCode === 13)) {
            toggleForm();
            if ((z === '') || (z === null)) {
                document.getElementById('chat-frame').src = url;
                z = document.getElementById('chat-frame').src
            }
        }
    });

    // keyDown event on arrowUp to open chatBot
    document.getElementById('arrowUp').addEventListener('keydown', function () {
        // To handle keyboard operations for 38 (keyUp) 40 (keydown) 32 (Space) 13 (enter)
        if ((event.keyCode === 38) || (event.keyCode === 40) || (event.keyCode === 32) || (event.keyCode === 13)) {
            toggleForm();
            if ((z === '') || (z === null)) {
                document.getElementById('chat-frame').src = url;
                z = document.getElementById('chat-frame').src
            }

        }
    });

    // closing chatBot
    // mousedown event on heading area to close the chatBot
    document.getElementById('chat_on').addEventListener('mousedown', function () {
        toggleForm();
    });

    //keydown event on heading area to close the chatbot
    document.getElementById('chat_on').addEventListener('keydown', function () {
        if ((event.keyCode === 38) || (event.keyCode === 40) || (event.keyCode === 32) || (event.keyCode === 13)) {
            toggleForm();
        }
    });
    
    // To handle keyboard operations for 38 (keyUp) 40 (keydown) 32 (Space)
    document.getElementById('close').addEventListener('keydown', function () {
        if ((event.keyCode === 13) || (event.keyCode === 40) || (event.keyCode === 32) || (event.keyCode === 38)) {
            toggleForm();
        }
    });
    // To handle keyboard operations and mouse click end here
    function toggleForm() {
        if (y.style.display === "block") {
            y.style.display = "none";
            x.style.display = "block";
        } else if (y.style.display === "none") {
            x.style.display = "none";
            y.style.display = "block";
        }
        const state = document.getElementById("chat-window").style.display;
        const newState = state === 'none' ? 'flex' : 'none';
        newState === "none" ?
            document.getElementById("toggle-open").classList.add("toggle-icon-open") :
            document
                .getElementById("toggle-open")
                .classList.remove("toggle-icon-open");
        document.getElementById("chat-window").style.display = newState;

        if (newState === "none") {
            document.getElementById('main-container').classList.add("close");
            document.getElementById('main-container').classList.remove("open");
        } else if (newState === 'flex') {
            document.getElementById('main-container').classList.remove("close");
            document.getElementById('main-container').classList.add("open");
            document.getElementById('badgeID').style.display = 'none';
            counter = 0;
        }
    }
  </script>
</body>
